# 第一章 Webpack 简介

## 1.1 Webpack 是什么

![image-20210728101319031](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210728101319031.png)

tips：个人理解：所谓资源构建工具就是将 babel、less 等工具包杂糅在一起的工具（比如可以将 es6 -> es5, jsx -> js， less -> css），具备一个预处理功能

## 1.2 webpack 五个核心概念

### 1.2.1 Entry

入口(Entry)：指示 webpack 以哪个文件为入口起点开始打包，分析构建内部依赖图。

### 1.2.2 Output

输出(Output)：指示 webpack 打包后的资源 bundles 输出到哪里去，以及如何命名。

### 1.2.3 Loader（理解成模块规则）

- Loader：让 webpack 能够去处理那些非 JS 的文件，比如样式文件、图片文件(webpack 自身只理解JS)
- Loader 就像一个翻译官 将资源编译成 webpack 能理解的 js  

### 1.2.4 Plugins

- 插件(Plugins)：可以用于执行范围更广的任务。插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量等。
- Plugin 就像一个给力的助手，可以帮助 webpack 完成各种想要的事情

### 1.2.5 Mode

模式(Mode)：指示 webpack 使用相应模式的配置。

| 选项        | 描述                                                         | 特点                       |
| ----------- | ------------------------------------------------------------ | -------------------------- |
| development | 会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 development。启用 NamedChunksPlugin 和 NamedModulesPlugin。 | 能让代码本地调试运行的环境 |
| production  | 会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 production。启用 FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin 和 TerserPlugin。 | 能让代码优化上线运行的环境 |

# 第二章 Webpack 初体验

## 2.1 初始化配置

1. 初始化 package.json：npm init

2. 下载安装webpack：(webpack4以上的版本需要全局/本地都安装webpack-cli)

   全局安装：cnpm i webpack webpack-cli -g

   本地安装：cnpm i webpack webpack-cli -D

## 2.2 编译打包应用

创建 src 下的 js 等文件后，不需要配置 webpack.config.js 文件，在命令行就可以编译打包。

指令：

- 开发环境：webpack ./src/index.js -o ./build --mode=development

  webpack会以 ./src/index.js 为入口文件开始打包，打包后输出到 ./build/main.js 整体打包环境，是开发环境

- 生产环境：webpack ./src/index.js -o ./build --mode=production

  webpack会以 ./src/index.js 为入口文件开始打包，打包后输出到 ./build/main.js 整体打包环境，是生产环境

- main.js 文件是自动生成的

结论：

1. webpack 本身能处理 js/json 资源，不能处理 css/img 等其他资源
2. 生产环境和开发环境将 ES6 模块化编译成浏览器能识别的模块化，但是不能处理 ES6 的基本语法转化为 ES5（需要借助 loader）
3. 生产环境比开发环境多一个压缩 js 代码

# 第三章 Webpack 开发环境的基本配置（重点）

```
webpack.config.js 是 webpack 的配置文件。

作用: 指示 webpack 干哪些活（当你运行 webpack 指令时，会加载里面的配置）

所有构建工具都是基于 nodejs 平台运行的，模块化默认采用 commonjs。

开发环境配置主要是为了能让代码运行。主要考虑以下几个方面：

- 打包样式资源
- 打包 html 资源
- 打包图片资源
- 打包其他资源
- devServer
```

![image-20210728114459105](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210728114459105.png)

![image-20210728114535728](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210728114535728.png)

```
const { resolve } = require('path');

module.exports = {
  // webpack配置
  // 入口起点
  entry: './src/index.js',
  // 输出
  output: {
    // 输出文件名
    filename: 'test.js',
    // 输出路径
    // __dirname nodejs的变量，代表当前文件的目录绝对路径
    path: resolve(__dirname, 'build')
  },
  // loader的配置
  module: {
    rules: [
      // 详细loader配置
      // 不同文件必须配置不同loader处理
      {
        // 匹配哪些文件
        test: /\.css$/,
        // 使用哪些loader进行处理
        use: [
          // use数组中loader执行顺序：从右到左，从下到上 依次执行
          // 创建style标签，将js中的样式资源插入进行，添加到head中生效
          'style-loader',
          // 将css文件变成commonjs模块加载js中，里面内容是样式字符串(变成 js 能懂的东西)
          'css-loader'
        ]
      },
      {
        test: /\.less$/i,
        use: [
          'style-loader',
          'css-loader',
          // 将 less 转换为 css
          'less-loader'
        ]
      }
    ]
  },
  // plugins的配置
  plugins: [
    // 详细plugins的配置
  ],
  // 模式
  mode: 'development', // 开发模式
  // mode: 'production'
}

```

**tips：自己尝试的时候 less 文件都是打包失败**

![image-20210728120337897](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210728120337897.png)

![image-20210826215256198](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826215256198.png)

![image-20210826215325960](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826215325960.png)

![image-20210826220407230](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826220407230.png)

![image-20210826220417413](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826220417413.png)

![image-20210826220424647](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826220424647.png)

![image-20210826221645091](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826221645091.png)

![image-20210826221653990](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826221653990.png)

![image-20210826224002511](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826224002511.png)

![image-20210826224016574](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826224016574.png)

![image-20210826224023819](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826224023819.png)

# 第四章 Webpack 生产环境的基本配置

而生产环境的配置需要考虑以下几个方面：

- 提取 css 成单独文件
- css 兼容性处理
- 压缩 css
- js 语法检查
- js 兼容性处理
- js 压缩
- html 压缩

## 提取 css 成单独文件

![image-20210826225426849](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826225426849.png)

![image-20210826225440486](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210826225440486.png)

## css 兼容性处理

tips：postcss-loader 用于 css 兼容处理，注意要在 package.json 中配置 browserslist

![image-20210827101002712](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827101002712.png)

![image-20210827101044356](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827101044356.png)

![image-20210827101106798](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827101106798.png)

## 压缩 CSS

![image-20210827112813157](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827112813157.png)

tips：该插件用于压缩 css

![image-20210827112832791](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827112832791.png)

![image-20210827112845214](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827112845214.png)

## js 语法检查

![image-20210827120350243](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827120350243.png)

![image-20210827120400790](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827120400790.png)

![image-20210827120409793](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210827120409793.png)

## js 兼容性处理

![image-20210828100358599](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828100358599.png)

![image-20210828100504043](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828100504043.png)

![image-20210828100415497](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828100415497.png)

![image-20210828100429354](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828100429354.png)

## js 压缩

![image-20210828102229522](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828102229522.png)

tips：修改是生产环境就会自动压缩代码，因为生产环境会自动引入一个压缩的插件

## HTML 压缩

![image-20210828102306487](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828102306487.png)

tips：要压缩 html 代码在 HtmlWebpackPlugin 中配置就可以了

## 生产环境配置整合

![image-20210828104845634](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828104845634.png)

![image-20210828104903724](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828104903724.png)

![image-20210828104918801](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828104918801.png)

![image-20210828104929756](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828104929756.png)

# 第五章 Webpack 优化配置

## HMR 

```
/*
  HMR: hot module replacement 热模块替换 / 模块热替换
    作用：一个模块发生变化，只会重新打包这一个模块（而不是重新打包所有模块，假如说你改变了一个模块但是却相关的其他模块命名美哟变动却要重新打包，这样效率是非常低的） 
      极大提升构建速度
      
      样式文件：可以使用HMR功能：因为style-loader内部实现了~
      js文件：默认不能使用HMR功能 --> 需要修改js代码，添加支持HMR功能的代码
        注意：HMR功能对js的处理，只能处理非入口js文件的其他文件（修改入口文件还是会引起所有的东西重新打包）。
      html文件: 默认不能使用HMR功能.同时会导致问题：html文件不能热更新了~ （不用做HMR功能）
        解决：修改entry入口，将html文件引入
*/
```

![image-20210828111048904](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828111048904.png)

![image-20210828111106117](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210828111106117.png)

## source-map

```
/*
  source-map: 一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）

    [inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map

    source-map：外部
      错误代码准确信息 和 源代码的错误位置
    inline-source-map：内联
      只生成一个内联source-map
      错误代码准确信息 和 源代码的错误位置
    hidden-source-map：外部
      错误代码错误原因，但是没有错误位置
      不能追踪源代码错误，只能提示到构建后代码的错误位置
    eval-source-map：内联
      每一个文件都生成对应的source-map，都在eval
      错误代码准确信息 和 源代码的错误位置
    nosources-source-map：外部
      错误代码准确信息, 但是没有任何源代码信息
    cheap-source-map：外部
      错误代码准确信息 和 源代码的错误位置 
      只能精确的行
    cheap-module-source-map：外部
      错误代码准确信息 和 源代码的错误位置 
      module会将loader的source map加入

    内联 和 外部的区别：1. 外部生成了文件，内联没有 2. 内联构建速度更快

    开发环境：速度快，调试更友好
      速度快(eval>inline>cheap>...)
        eval-cheap-souce-map
        eval-source-map
      调试更友好  
        souce-map
        cheap-module-souce-map
        cheap-souce-map

      --> eval-source-map  / eval-cheap-module-souce-map

    生产环境：源代码要不要隐藏? 调试要不要更友好
      内联会让代码体积变大，所以在生产环境不用内联
      nosources-source-map 全部隐藏
      hidden-source-map 只隐藏源代码，会提示构建后代码错误信息

      --> source-map / cheap-module-souce-map
*/
```

![image-20210829094658467](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829094658467.png)

![image-20210829094725689](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829094725689.png)

![image-20210829094735124](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829094735124.png)

## oneOf

tips：oneOf 可以提升打包构建速度，让一个文件不会被多个模块匹配到，当一个文件只需对应一个模块就可以将这个模块写进 oneOf 里面，这样当它被 oneOf 里面的模块匹配到时，其他模块也不用浪费时间进行匹配。

![image-20210829095351429](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829095351429.png)

![image-20210829095411719](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829095411719.png)

![image-20210829095512529](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829095512529.png)

![image-20210829095524994](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829095524994.png)

## 缓存

```
/*
  缓存：
    babel缓存
      cacheDirectory: true
      --> 让第二次打包构建速度更快
    文件资源缓存
      hash: 每次wepack构建时会生成一个唯一的hash值。
        问题: 因为js和css同时使用一个hash值。
          如果重新打包，会导致所有缓存失效。（可能我却只改动一个文件）
      chunkhash：根据chunk生成的hash值。如果打包来源于同一个chunk，那么hash值就一样
        问题: js和css的hash值还是一样的
          因为css是在js中被引入的，所以同属于一个chunk
          chunk（代码块）: 在 webpack 中入口文件引入的各种依赖最终通过打包形成一个文件就是一个chunk
      contenthash: 根据文件的内容生成hash值。不同文件hash值一定不一样，这种文件 hash 值重新打包时只有文件内容改变了才会改		变，根据它这一特性来让浏览器识别缓存是否失效是最佳选择。    
      --> 让代码上线运行缓存更好使用
*/
```

![image-20210829104056410](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829104056410.png)

![image-20210829103522025](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829103522025.png)

![image-20210829104311281](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829104311281.png)

![image-20210829103543214](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829103543214.png)

## tree shaking

```
/*
  tree shaking：去除无用代码
    前提：1. 必须使用ES6模块化  2. 开启production环境
    作用: 减少代码体积

    在package.json中配置 
      "sideEffects": false 所有代码都没有副作用（都可以进行tree shaking）
        问题：可能会把css / @babel/polyfill （副作用）文件干掉
      "sideEffects": ["*.css", "*.less"] // 这里可以让 css，less 文件不被 tree shaking
*/
```

![image-20210829105729517](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829105729517.png)

![image-20210829105740007](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829105740007.png)

![image-20210829105753961](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829105753961.png)

![image-20210829105801956](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829105801956.png)

## code split

![image-20210829114640291](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829114640291.png)

tips: 通过配置多入口可以将代码切割，几个入口就会生成几个 chunk

![image-20210829114703059](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829114703059.png)

tips：通过 optimization 配置可以实现上面注释效果。比如像 1 说的那样如果你引入了 jq 它会将 jq 单独打包出来；像 2 说的那样如果多个入口文件中都引入了 jq 它会分析并只提取出一个 jq 这样就不会造成 jq 的重复引入，提高了生产环境效率

![image-20210829115120684](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829115120684.png)

![image-20210829115223589](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829115223589.png)

tips: 在开启 optimization 属性的前提下，通过 es6 的 import 语法也可以将引入的文件单独打包成一个 chunk

## lazy loading

![image-20210829120618451](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829120618451.png)

![image-20210829120809649](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210829120809649.png)

tips: 在入口文件中将引入语法写在回调函数中即可实现懒加载，而预加载配置 webpackPrefetch 属性为 true 即可实现，不过它的兼容性可能还不是很好
