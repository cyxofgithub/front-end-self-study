# 工具集成概述与实践示例

让大模型“会用工具”，是打造强大 AI 智能体的核心：模型遇到超出自身知识范畴时，能主动外部检索、数据查询、调用 API、做各种实操。

## 典型工具接入类型与实例

### 1. 网络搜索集成

> 让 AI 实时查找互联网信息，补充“知识盲区”。

**例子（LangChain.js 使用 Tavily 搜索）**：

```js
import { TavilySearchResults } from 'langchain/tools/tavily_search';

const tool = new TavilySearchResults();
const res = await tool.call('2024 年美国总统是谁？');
console.log(res);
// 输出：'截至2024年，总统为乔·拜登。'
```

### 2. 数据库查询

> 让模型像 BI 工具一样，能用自然语言问数据库。

**例子（SQL 查询工具集成）**：

```js
import { SqlDatabase, QuerySqlTool } from 'langchain/tools/sql';

const db = new SqlDatabase({
    /* 你的数据库连接配置 */
});
const tool = new QuerySqlTool(db);
const result = await tool.call('查询销售额最高的前 5 个商品');
console.log(result);
```

#### 语义化调用数据库原理与实践

“语义化数据库查询”指的是：用户用自然语言提问，大模型将其自动转化为 SQL 语句，完成数据库检索。这一般包括：1）语言理解，2）SQL 构造，3）安全执行，4）结果回传。

**核心流程：**

1. **模型理解输入**：AI 读取用户问题（如“查近 7 天的订单数”）。
2. **分析数据库结构**：AI 可预加载表结构、字段、示例数据等（LangChain 的 `SqlDatabase` 工具支持表结构 introspection）。
3. **自动生成 SQL**：用内嵌的 Prompt 指令，引导 LLM 把自然语言转为 SQL 语句。
4. **执行 SQL 并返回结果**：工具自动把 SQL 提交实际数据库，查到后通过 AI 优化可读结果。
5. **可选：多轮澄清**：如问题不明确，让 AI 反问补充需求，保证生成 SQL 的准确性和安全性。

**LangChain.js 实践案例：**

```js
import {
    SqlDatabase,
    createSqlAgent,
    queryTablesTool,
} from 'langchain/tools/sql';
import { ChatOpenAI } from 'langchain/chat_models/openai';

// ① 数据库连接
const db = new SqlDatabase({
    connectionOptions: {
        // 你的数据库配置，如 host/user/password/database
    },
});

// ② 创建 LLM 智能 agent
const llm = new ChatOpenAI({ openAIApiKey: process.env.OPENAI_API_KEY });

const agent = await createSqlAgent({
    llm,
    tools: [queryTablesTool(db)],
    db, // 传递数据库 schema 信息便于 LLM 理解字段名
    // 可选：支持指定允许访问的表等更细权限
});

// ③ 用户用自然语言问问题
const userInput = '最近3个月每月的订单总数和金额？';
const result = await agent.run(userInput);

console.log(result);
// 输出类似：
// [
//   { 月份: '2024-04', 订单数: 123, 总金额: 30999 },
//   { 月份: '2024-05', 订单数: 98, 总金额: 25008 },
//   ...
// ]
```

> 这种方式通过 LangChain 工具把 LLM 的文字理解和数据库自动推理结合，实现了无需 SQL 基础的“类自然语言 BI 查询”。实际场景要注意权限、安全防注入、长语句分词等细节。

### 3. API 调用工具

> 让 AI 通过 API 获取天气、翻译、日程等实际数据或服务。

**例子（调用天气预报 API）**：

```js
// 假设有一个 WeatherTool 封装了天气 API
const weatherTool = new WeatherTool({ apiKey: 'xxx' });
const weather = await weatherTool.call('北京市明天天气');
console.log(weather);
```

### 4. 自定义工具开发

> 针对具体业务、系统流程自定义集成工具。

**例子（自动呼叫公司 Slack 通知）**：

```js
import { SlackNotifyTool } from './my-tools/slack_notify';

const notify = new SlackNotifyTool({ token: 'xxx' });
await notify.call('AI 检测到服务器异常，请关注报警！');
```

---

通常，LangChain、ReAct、OpenAI function-calling 等框架，支持智能体根据任务内容，自动选择和调用上述工具，实现“多步思考+外部行动”。

你可以结合实际业务，把常用接口/数据库/API 封装成“可调用工具”，让 AI 助手真正能查、能问、能动手。
