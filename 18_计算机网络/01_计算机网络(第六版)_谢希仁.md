## 4.4 网际控制报文协议ICMP（还没看）

## 4.5 因特网的路由选择协议

本节将讨论几种常用的路由选择协议，也就是要讨论路由表中的路由是怎样得出的。

### 4.5.1 有关路由选择协议的几个基本概念

路由选择协议的核心就是路由算法，即需要何种算法来获得路由表中的各项目。一个理想的路由算法应具有如下的一些特点[BELL86]：

(1) 算法必须是正确的和完整的。这里，“正确”的含义是：沿着各路由表所指引的路由，分组一定能够最终到达目的网络和目的主机。



## 4.6 IP多播

### 4.6.1 IP多播的基本概念

![image-20210601150834855](C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20210601150834855.png)

与单播相比，在一对多的通信中，多播可大大节约网络资源。图4-46(a)是视频服务器用单播方式向90个主机传送同样的视频节目。为此，需要发送90个单播，即同一个视频分组要发送90个副本。

图4-46(b)是视频服务器用多播方式向属于同一个多播组的90个成员传送节目。这时，视频服务器只需把视频分组当作多播数据报来发送，并且只需发送一次。路由器R1在转发分组时，需要把收到的分组复制成3个副本，分别向R2、R3和R4各转发1个副本。当分组到达目的局域网时，由于局域网具有硬件多播功能，因此不需要复制分组，在局域网上的多播组成员都能收到这个视频分组。



当多播组的主机数很大时（如成千上万个），采用多播方式就可明显地减轻网络中各种资源的消耗。在因特网范围的多播要靠路由器来实现，这些路由器必须增加一些能够识别多播数据报的软件。**能够运行多播协议的路由器称为多播路由器(multicast router)。**多播路由器当然也可以转发普通的单播IP数据报。



**为了适应交互式音频和视频信息的多播**，从1992年起，在因特网上开始试验虚拟的多播主干网MBONE (Multicast BackboneOn the InterNEt)。 **MBONE可把分组传播给地点分散但属于一个组的许多个主机。**



在因特网上进行多播就叫做IP多播。IP多播所传送的分组需要使用多播IP地址。



我们知道，在因特网中每一个主机必须有一个全球唯一的IP地址。如果某个主机现在想接收某个特定多播组的分组，那么怎样才能使这个多播数据报传送到这个主机？

显然，这个多播数据报的目的地址一定不能写入这个主机的IP地址。这是因为在同一时间可能有成千上万个主机加入到同一个多播组。多播数据报不可能在其首部写入这样多的主机的IP地址。**在多播数据报的目的地址写入的是多播组的标识符，然后设法让加入到这个多播组的主机的IP地址与多播组的标识符关联起来。**

其实多播组的标识符就是IP地址中的D类地址。D类IP地址的前四位是1110，因此D类地址范围是224.0.0.0到239.255.255.255（见本章第4.2.2节第1小节“IP地址及其表示方法”）。我们就用每一个D类地址标志一个多播组。这样，D类地址共可标志228个多播组，也就是说，在同一时间可以允许有超过2.6亿的多播组在因特网上运行。多播数据报也是“尽最大努力交付”，不保证一定能够交付多播组内的所有成员。**因此，多播数据报和一般的IP数据报的区别就是它使用D类IP地址作为目的地址，并且首部中的协议字段值是2，表明使用网际组管理协议IGMP。**



**显然，多播地址只能用于目的地址，而不能用于源地址**。**此外，对多播数据报不产生ICMP差错报文。因此，若在PING命令后面键入多播地址，将永远不会收到响应。**



D类地址中有一些是不能随意使用的，因为有的地址已经被IANA指派为永久组地址了[RFC 5735]。例如：

- 224.0.0.0基地址（保留）
- 224.0.0.1在本子网上的所有参加多播的主机和路由器
- 224.0.0.2在本子网上的所有参加多播的路由器
- 224.0.0.3 未指派
- 224.0.0.4 DVMRP路由器
- ……
- 224.0.1.0至238.255.255.255 全球范围都可使用的多播地址
- 239.0.0.0至239.255.255.255 限制在一个组织的范围



**IP多播可以分为两种。**一种是只在本局域网上进行硬件多播，另一种则是在因特网的范围进行多播。前一种虽然比较简单，但很重要，因为现在大部分主机都是通过局域网接入到因特网的。在因特网上进行多播的最后阶段，还是要把多播数据报在局域网上用硬件多播交付多播组的所有成员（如图4-46(b)所示）。下面就先讨论这种硬件多播。



### 4.6.2 在局域网上进行硬件多播

### 4.6.3 网际组管理协议IGMP和多播路由选择协议



## 4.7 虚拟专用网VPN和网络地址转换NAT

### 4.7.1 虚拟专用网VPN

由于IP地址的紧缺，一个机构能够申请到的IP地址数往往远小于本机构所拥有的主机数。考虑到因特网并不很安全，一个机构内也并不需要把所有的主机接入到外部的因特网。实际上，在许多情况下，很多主机主要还是和本机构内的其他主机进行通信（例如，在大型商场或宾馆中，有很多用于营业和管理的计算机。显然这些计算机并不都需要和因特网相连）。**假定在一个机构内部的计算机通信也是采用TCP/IP协议，那么从原则上讲，对于这些仅在机构内部使用的计算机就可以由本机构自行分配其IP地址。这就是说，让这些计算机使用仅在本机构有效的IP地址（这种地址称为本地地址），而不需要向因特网的管理机构申请全球唯一的IP地址（这种地址称为全球地址）。这样就可以大大节约宝贵的全球IP地址资源。**

**但是，如果任意选择一些IP地址作为本机构内部使用的本地地址，那么在某种情况下可能会引起一些麻烦**。例如，有时机构内部的某个主机需要和因特网连接，那么这种仅在内部使用的本地地址就有可能和因特网中某个IP地址重合，这样就会出现地址的二义性问题。

**为了解决这一问题，RFC 1918指明了一些专用地址(private address)。这些地址只能用于一个机构的内部通信，而不能用于和因特网上的主机通信。**换言之，专用地址只能用作本地地址而不能用作全球地址。在因特网中的所有路由器，对目的地址是专用地址的数据报一律不进行转发。2010年1月，RFC 5735全面地给出了所有特殊用途的IPv4地址，但三个专用地址块的指派并无变化，即

**(1) 10.0.0.0到10.255.255.255 （或记为10.0.0.0/8，它又称为24位块）**

**(2) 172.16.0.0到172.31.255.255 （或记为172.16.0.0/12，它又称为20位块）**

**(3) 192.168.0.0到192.168.255.255 （或记为192.168.0.0/16，它又称为16位块）**

上面的三个地址块分别相当于一个A类网络、16个连续的B类网络和256个连续的C类网络。A类地址本来早已用完了，而上面的地址10.0.0.0本来是分配给ARPANET的。由于ARPANET已经关闭停止运行了，因此这个地址就用作专用地址。

**采用这样的专用IP地址的互连网络称为专用互联网或本地互联网，或更简单些，就叫做专用网。**显然，全世界可能有很多的专用互连网络具有相同的专用IP地址，但这并不会引起麻烦，因为这些专用地址仅在本机构内部使用。**专用IP地址也叫做可重用地址(reusable address)。**

**有时一个很大的机构有许多部门分布在相距很远的一些地点，而在每一个地点都有自己的专用网。假定这些分布在不同地点的专用网需要经常进行通信。这时，可以有两种方法。**第一种方法是租用电信公司的通信线路为本机构专用。这种方法的好处是简单方便，但线路的租金太高。**第二种方法是利用公用的因特网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网VPN (Virtual PrivateNetwork)。**

