## 高阶组件

### 是什么

在 React 中，高阶组件即接受一个或多个组件作为参数并且返回一个组件，本质也就是一个函数，并不是一个组件

```javascript
const EnhancedComponent = highOrderComponent(WrappedComponent);
```

高阶组件的这种实现方式，本质上是一个装饰者设计模式

### 如何编写

```javascript
import React, { Component } from "react";

export default (WrappedComponent) => {
    return class EnhancedComponent extends Component {
        // do something
        render() {
            return <WrappedComponent />;
        }
    };
};
```

使用高阶组件的同时，一般遵循一些约定，如下：

-   不要以任何方式改变原始组件 WrappedComponent
-   透传不相关 props 属性给被包裹的组件 WrappedComponent
-   不要再 render() 方法中使用高阶组件, 这样会造成重复创建高阶的组件实例
-   使用 compose 组合高阶组件
-   包装显示名字以便于调试

注：本质就是装饰器模式的一种应用，真实使用场景无非就是复用一些逻辑，数据缓存等

### 传递 ref

这里需要注意的是，高阶组件可以传递所有的 props，但是不能传递 ref

如果向一个高阶组件添加 refe 引用，那么 ref 指向的是最外层容器组件实例的，而不是被包裹的组件，如果需要传递 refs 的话，则使用 React.forwardRef，如下：

```javascript
function withLogging(WrappedComponent) {
    class Enhance extends WrappedComponent {
        componentWillReceiveProps() {
            console.log("Current props", this.props);
            console.log("Next props", nextProps);
        }
        render() {
            const { forwardedRef, ...rest } = this.props;
            // 把 forwardedRef 赋值给 ref
            return <WrappedComponent {...rest} ref={forwardedRef} />;
        }
    }

    // React.forwardRef 方法会传入 props 和 ref 两个参数给其回调函数
    // 所以这边的 ref 是由 React.forwardRef 提供的
    function forwardRef(props, ref) {
        return <Enhance {...props} forwardRef={ref} />;
    }

    return React.forwardRef(forwardRef);
}
const EnhancedComponent = withLogging(SomeComponent);
```

### 使用 compose 组合高阶组件

代码示例：

```javascript
import React from "react";

// 高阶组件1
function withHOC1(Component) {
    // 返回增强组件
    return function EnhancedComponent1(props) {
        // 在此处应用高阶组件1的逻辑
        // ...

        // 返回原始组件
        return <Component {...props} />;
    };
}

// 高阶组件2
function withHOC2(Component) {
    // 返回增强组件
    return function EnhancedComponent2(props) {
        // 在此处应用高阶组件2的逻辑
        // ...

        // 返回原始组件
        return <Component {...props} />;
    };
}

// 原始组件
function MyComponent(props) {
    // 渲染组件的 UI
    return <div>{props.text}</div>;
}

// 使用 compose 组合高阶组件
const EnhancedComponent = compose(withHOC1, withHOC2)(MyComponent);

// 在组件定义的外部使用增强后的组件
function App() {
    return <EnhancedComponent text="Hello World" />;
}
```

注：compose(withHOC1, withHOC2) 的执行顺序是从右到左，即先应用 withHOC2 的逻辑，然后再应用 withHOC1 的逻辑。

通过使用 compose，我们可以更方便地组合多个高阶组件，并将它们的逻辑应用到一个组件上，使代码更加简洁和易于理解。
